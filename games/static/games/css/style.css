@import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@400;700&display=swap');

/* ─────────────── Design Tokens ─────────────── */
:root {
    /* Page */
    --bg-color: #1e0e08;
    --bg-color-light: #3a1e10;
    --text-color: #f0f0f0;

    /* Board Frame */
    --shell-bg: #c4a06a;
    --shell-bg-dark: #a0834e;
    --shell-border: #d4ba8a;
    --shell-border-inner: #6b4226;
    --shell-radius: 18px;

    /* Board Surface */
    --surface-bg: #f0dca0;
    --surface-bg-light: #f7eac0;
    --surface-bg-warm: #e6c87a;
    --surface-border: #7a5230;
    --surface-radius: 10px;

    /* Board Grid Area */
    --board-bg: #e8c88a;
    --board-bg-light: #f0dca8;
    --board-frame: #c4a060;
    --board-frame-dark: #8b6530;
    --grid-stroke: #8b6c42;

    /* Pieces */
    --piece-red-outer: #b5372a;
    --piece-red-inner: #d04a3a;
    --piece-red-highlight: #e86050;
    --piece-black-outer: #2c2c2c;
    --piece-black-inner: #4a4a4a;
    --piece-black-highlight: #666;
    --piece-rim: #f5e6c8;
    --piece-size-ratio: 0.82;

    /* Interaction */
    --highlight-gold: #f0b429;
    --hint-orange: #e67e22;
    --accent-gold: #ffd700;
    --accent-orange: #d4862b;
}

/* ─────────────── Base / Page ─────────────── */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Noto Sans SC', sans-serif;
    background:
        /* deep vignette */
        radial-gradient(ellipse 70% 65% at 50% 50%,
            transparent 20%,
            rgba(0, 0, 0, 0.75) 100%),
        /* warm spotlight behind board */
        radial-gradient(ellipse 55% 50% at 50% 45%,
            rgba(80, 40, 18, 0.45) 0%,
            transparent 70%),
        /* rich dark-wood base */
        linear-gradient(170deg, #2e1408 0%, #1a0a04 50%, #0f0602 100%);
    background-attachment: fixed;
    color: var(--text-color);
    margin: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

/* ─────────────── Layout ─────────────── */
.main-container {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 16px;
    width: 100%;
    height: 100vh;
}

.game-area {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
}

/* ═══════════════════════════════════════════════
   Board Shell — Outer Frame (Layer 1)
   ═══════════════════════════════════════════════ */
.board-shell {
    /* ── Sizing ── */
    width: min(92vw, 760px);
    aspect-ratio: 9 / 10;
    max-height: 95vh;
    position: relative;

    /* ── Frame padding ── */
    padding: 20px;

    /* ── Wood-grain background ── */
    background:
        /* horizontal grain — very fine */
        repeating-linear-gradient(93deg,
            rgba(0, 0, 0, 0.06) 0px,
            transparent 1px,
            transparent 4px,
            rgba(0, 0, 0, 0.03) 4px,
            transparent 5px,
            transparent 9px),
        /* vertical cross-grain — even subtler */
        repeating-linear-gradient(2deg,
            rgba(0, 0, 0, 0.02) 0px,
            transparent 1px,
            transparent 14px),
        /* bevel: top-left lighter, bottom-right darker */
        linear-gradient(135deg,
            #dcc898 0%,
            #c8a870 20%,
            #b89858 50%,
            #a48548 80%,
            #8a6e38 100%);

    border-radius: 16px;

    /* ── Double-border impression ── */
    /* Outer rim: light gold, then thin dark inset via box-shadow */
    border: 3px solid #c8b080;

    /* ── Depth shadow stack ── */
    box-shadow:
        /* 1. main drop shadow — strong, lifts board off table */
        0 20px 60px rgba(0, 0, 0, 0.7),
        0 8px 20px rgba(0, 0, 0, 0.4),
        /* 2. very subtle outer glow (warm) */
        0 0 80px rgba(60, 30, 10, 0.3),
        /* 3. outer rim highlight — top edge catch light */
        0 -1px 0 rgba(255, 240, 200, 0.2),
        /* 4. inner bevel — top-left light */
        inset 2px 2px 4px rgba(255, 240, 200, 0.3),
        /* 5. inner bevel — bottom-right dark */
        inset -2px -2px 6px rgba(0, 0, 0, 0.25),
        /* 6. inner dark rim to separate from surface */
        inset 0 0 0 1px rgba(80, 50, 20, 0.5);
}

/* Bevel highlight overlay on the frame */
.board-shell::before {
    content: "";
    position: absolute;
    inset: 4px;
    border-radius: 13px;
    /* inner rim line — dark brown border feel */
    border: 2px solid rgba(70, 40, 15, 0.6);
    /* subtle inner highlight on top edge */
    box-shadow:
        inset 0 1px 0 rgba(255, 240, 200, 0.15);
    pointer-events: none;
    z-index: 0;
}

/* ═══════════════════════════════════════════════
   Board Surface — Inner Mat (Layer 2)
   ═══════════════════════════════════════════════ */
.board-surface {
    /* Fill the shell */
    width: 100%;
    height: 100%;
    position: relative;

    /* ── Frame padding for grid area ── */
    padding: 14px;

    /* ── Parchment base ── */
    background:
        /* warm parchment gradient — top lighter, bottom slightly warmer */
        linear-gradient(180deg,
            #f5e8c8 0%,
            #f0ddb4 30%,
            #ebcf98 70%,
            #e4c488 100%);

    border-radius: 8px;

    /* ── Subtle inset border ── */
    border: 1.5px solid rgba(100, 60, 25, 0.45);

    /* ── Recessed inner shadow ── */
    box-shadow:
        /* deep all-around inset for "sunk" feel */
        inset 0 4px 14px rgba(80, 40, 10, 0.2),
        inset 0 -3px 10px rgba(80, 40, 10, 0.12),
        inset 4px 0 12px rgba(80, 40, 10, 0.08),
        inset -4px 0 12px rgba(80, 40, 10, 0.08),
        /* soft inner glow at center */
        inset 0 0 40px rgba(255, 240, 200, 0.08);
}

/* Vignette overlay — edges darken */
.board-surface::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: 8px;
    background: radial-gradient(ellipse 80% 78% at 50% 48%,
            transparent 45%,
            rgba(100, 60, 20, 0.18) 85%,
            rgba(60, 30, 8, 0.28) 100%);
    pointer-events: none;
    z-index: 0;
}

/* Subtle noise texture overlay — organic paper feel */
.board-surface::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: 8px;
    background:
        /* faux noise via many tiny offset gradients */
        repeating-radial-gradient(circle at 17% 23%, rgba(0, 0, 0, 0.012) 0px, transparent 1px, transparent 3px),
        repeating-radial-gradient(circle at 83% 67%, rgba(0, 0, 0, 0.015) 0px, transparent 1px, transparent 4px),
        repeating-radial-gradient(circle at 41% 79%, rgba(0, 0, 0, 0.01) 0px, transparent 1px, transparent 5px),
        repeating-radial-gradient(circle at 69% 11%, rgba(0, 0, 0, 0.012) 0px, transparent 1px, transparent 3px),
        /* very subtle cross-hatch for organic texture */
        repeating-linear-gradient(47deg,
            transparent,
            transparent 3px,
            rgba(120, 80, 30, 0.015) 3px,
            rgba(120, 80, 30, 0.015) 4px),
        repeating-linear-gradient(133deg,
            transparent,
            transparent 5px,
            rgba(120, 80, 30, 0.01) 5px,
            rgba(120, 80, 30, 0.01) 6px);
    pointer-events: none;
    z-index: 0;
}

/* ─────────────── Board Inner (Grid Area) ─────────────── */
.board-inner {
    position: relative;
    /* Fill the surface — JS will also set explicit px dimensions */
    width: 100%;
    height: 100%;

    /* Transparent base — inherits parchment from surface */
    background: transparent;

    overflow: visible;
    user-select: none;
    -webkit-user-select: none;
    cursor: default;
    z-index: 1;
}

/* ─────────────── SVG Grid Overlay ─────────────── */
.board-svg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
}

/* ─────────────── Pieces ─────────────── */
.piece {
    position: absolute;
    z-index: 5;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    -webkit-user-select: none;

    /* Double-ring coin effect via box-shadow */
    transition:
        transform 0.18s cubic-bezier(.25, .8, .25, 1),
        box-shadow 0.18s cubic-bezier(.25, .8, .25, 1),
        filter 0.18s ease;
}

/* ─── Slide Animation ─── */
.piece--sliding {
    transition: transform 0.45s cubic-bezier(0.33, 1, 0.68, 1) !important;
    z-index: 50 !important;
    pointer-events: none !important;
}

/* ─── Captured Piece Fade-Out ─── */
.piece--captured {
    animation: fadeOutPiece 0.15s ease-out forwards;
    pointer-events: none !important;
}

@keyframes fadeOutPiece {
    to {
        opacity: 0;
        transform: scale(0.6);
    }
}

/* ─── Board Animating Lock ─── */
.board--animating {
    pointer-events: none !important;
}

/* Red pieces */
.piece-red {
    background: radial-gradient(circle at 38% 32%,
            var(--piece-red-highlight) 0%,
            var(--piece-red-inner) 40%,
            var(--piece-red-outer) 100%);
    box-shadow:
        /* outer colored ring */
        0 0 0 3px var(--piece-red-outer),
        /* cream inner ring */
        0 0 0 5px var(--piece-rim),
        /* outer border */
        0 0 0 6px #8b1a1a,
        /* drop shadow */
        0 4px 10px rgba(0, 0, 0, 0.4),
        /* inner gloss */
        inset 0 2px 4px rgba(255, 255, 255, 0.25),
        inset 0 -2px 4px rgba(0, 0, 0, 0.15);
    color: #fff;
    text-shadow:
        0 1px 2px rgba(0, 0, 0, 0.5),
        0 0 8px rgba(255, 200, 200, 0.3);
}

/* Black pieces */
.piece-black {
    background: radial-gradient(circle at 38% 32%,
            var(--piece-black-highlight) 0%,
            var(--piece-black-inner) 40%,
            var(--piece-black-outer) 100%);
    box-shadow:
        /* outer colored ring */
        0 0 0 3px var(--piece-black-outer),
        /* cream inner ring */
        0 0 0 5px var(--piece-rim),
        /* outer border */
        0 0 0 6px #111,
        /* drop shadow */
        0 4px 10px rgba(0, 0, 0, 0.5),
        /* inner gloss */
        inset 0 2px 4px rgba(255, 255, 255, 0.15),
        inset 0 -2px 4px rgba(0, 0, 0, 0.2);
    color: #e8e0d0;
    text-shadow:
        0 1px 2px rgba(0, 0, 0, 0.6),
        0 0 6px rgba(200, 200, 200, 0.2);
}

/* Piece text (Chinese character) */
.piece-text {
    font-family: 'Ma Shan Zheng', 'KaiTi', 'SimKai', 'STKaiti', serif;
    font-weight: bold;
    line-height: 1;
    pointer-events: none;
}

/* ─── Piece Hover ─── */
.piece:hover {
    transform: translateY(-2px);
    filter: brightness(1.08);
    z-index: 10;
}

.piece-red:hover {
    box-shadow:
        0 0 0 3px var(--piece-red-outer),
        0 0 0 5px var(--piece-rim),
        0 0 0 6px #8b1a1a,
        0 6px 16px rgba(0, 0, 0, 0.5),
        inset 0 2px 4px rgba(255, 255, 255, 0.25),
        inset 0 -2px 4px rgba(0, 0, 0, 0.15);
}

.piece-black:hover {
    box-shadow:
        0 0 0 3px var(--piece-black-outer),
        0 0 0 5px var(--piece-rim),
        0 0 0 6px #111,
        0 6px 16px rgba(0, 0, 0, 0.6),
        inset 0 2px 4px rgba(255, 255, 255, 0.15),
        inset 0 -2px 4px rgba(0, 0, 0, 0.2);
}

/* ─── Piece Selected ─── */
.piece.selected {
    transform: translateY(-2px);
    filter: brightness(1.1);
    z-index: 20;
}

.piece-red.selected {
    box-shadow:
        0 0 0 3px var(--piece-red-outer),
        0 0 0 5px var(--piece-rim),
        0 0 0 6px #8b1a1a,
        /* Golden glow ring */
        0 0 0 9px var(--highlight-gold),
        0 0 18px rgba(240, 180, 41, 0.5),
        0 6px 16px rgba(0, 0, 0, 0.4),
        inset 0 2px 4px rgba(255, 255, 255, 0.25),
        inset 0 -2px 4px rgba(0, 0, 0, 0.15);
}

.piece-black.selected {
    box-shadow:
        0 0 0 3px var(--piece-black-outer),
        0 0 0 5px var(--piece-rim),
        0 0 0 6px #111,
        /* Golden glow ring */
        0 0 0 9px var(--highlight-gold),
        0 0 18px rgba(240, 180, 41, 0.5),
        0 6px 16px rgba(0, 0, 0, 0.5),
        inset 0 2px 4px rgba(255, 255, 255, 0.15),
        inset 0 -2px 4px rgba(0, 0, 0, 0.2);
}

/* ─── Legal Move Hint Dots ─── */
.hint-dot {
    position: absolute;
    z-index: 3;
    pointer-events: none;
    border-radius: 50%;
    background: var(--hint-orange);
    opacity: 0.8;
    box-shadow: 0 0 6px rgba(230, 126, 34, 0.5);
}

/* ─── Last Move Indicator ─── */
.last-move-target::after {
    content: '';
    position: absolute;
    top: -4px;
    left: -4px;
    right: -4px;
    bottom: -4px;
    border-radius: 50%;
    border: 2.5px solid #e67e22;
    /* Earthy orange */
    box-shadow: 0 0 8px rgba(230, 126, 34, 0.6);
    /* Glow halo */
    pointer-events: none;
    z-index: 6;
    /* Above piece, below dragged */
}

/* ─── Capture Target Ring (Purple) ─── */
.capture-target::before {
    content: '';
    position: absolute;
    top: -6px;
    left: -6px;
    right: -6px;
    bottom: -6px;
    border-radius: 50%;
    border: 2.5px solid #8b5cf6;
    box-shadow:
        0 0 10px rgba(139, 92, 246, 0.55),
        0 0 20px rgba(139, 92, 246, 0.25);
    pointer-events: none;
    z-index: 7;
}

/* ─── Old Position Marker (Transient) ─── */
.old-pos-marker {
    position: absolute;
    width: 12px;
    height: 12px;
    background-color: #d35400;
    /* Dark Orange */
    /* Brown semi-transparent */
    border-radius: 50%;
    transform: translate(-50%, -50%);
    /* Centering */
    z-index: 2;
    /* Above board, below pieces */
    pointer-events: none;
    opacity: 1;
    transition: opacity 0.5s ease-out;
}

/* ═══════════════════════════════════════════════
   Responsive Rules
   ═══════════════════════════════════════════════ */

/* Mobile: tighter padding */
@media (max-width: 520px) {
    .board-shell {
        padding: 14px;
        border-width: 2.5px;
        border-radius: 12px;
    }

    .board-shell::before {
        inset: 3px;
        border-radius: 10px;
    }

    .board-surface {
        padding: 8px;
        border-radius: 6px;
    }

    .board-surface::before,
    .board-surface::after {
        border-radius: 6px;
    }

    .main-container {
        padding: 8px;
    }
}