@import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@400;700&display=swap');

/* ─── Xiangqi Piece Font — Noto Serif TC subset (14 glyphs only, WOFF2) ──────
   Glyph list: 帥仕相傌俥炮兵 將士象馬車砲卒
   Downloaded via Google Fonts API
   ──────────────────────────────────────────────────────────────────────── */
@font-face {
    font-family: 'XiangqiSerif';
    src: url('../fonts/xiangqi-serif-subset.woff2') format('woff2');
    font-weight: bold;
    font-style: normal;
    /* block: keep layout stable while font loads (no FOUT for piece chars) */
    font-display: block;
}

/* ─────────────── Design Tokens ─────────────── */
:root {
    /* Page */
    --bg-color: #2a120b;
    --text-color: #f0f0f0;

    /* Board */
    --board-bg: #e8c88a;
    --board-bg-light: #f0dca8;
    --board-frame: #c4a060;
    --board-frame-dark: #8b6530;
    --grid-stroke: #8b6c42;

    /* Pieces */
    --piece-red-outer: #b5372a;
    --piece-red-inner: #d04a3a;
    --piece-red-highlight: #e86050;
    --piece-black-outer: #2c2c2c;
    --piece-black-inner: #4a4a4a;
    --piece-black-highlight: #666;
    --piece-rim: #f5e6c8;
    --piece-size-ratio: 0.82;

    /* Interaction */
    --highlight-gold: #f0b429;
    --hint-orange: #e67e22;
    --accent-gold: #ffd700;
    --accent-orange: #d4862b;

}

/* ─────────────── Base ─────────────── */
body {
    font-family: 'Noto Sans SC', sans-serif;
    background:
        radial-gradient(ellipse 80% 80% at 50% 50%,
            transparent 40%,
            rgba(0, 0, 0, 0.65) 100%),
        radial-gradient(ellipse at 50% 40%,
            #4b2416 0%,
            #2a120b 70%);
    color: var(--text-color);
    margin: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

/* ─────────────── Layout ─────────────── */
.main-container {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    width: 100%;
    height: 95vh;
}

.game-area {
    display: flex;
    justify-content: center;
    align-items: center;
}

/* ─────────────── Board Wrapper (Wood Frame) ─────────────── */
.board-wrapper {
    padding: 28px;
    background:
        /* subtle wood grain */
        repeating-linear-gradient(92deg,
            rgba(0, 0, 0, 0.04) 0px,
            rgba(0, 0, 0, 0.04) 1px,
            transparent 1px,
            transparent 7px),
        repeating-linear-gradient(0deg,
            rgba(0, 0, 0, 0.02) 0px,
            rgba(0, 0, 0, 0.02) 1px,
            transparent 1px,
            transparent 14px),
        linear-gradient(160deg, #d4b896 0%, #c4a87a 40%, #b8985a 100%);
    border-radius: 16px;
    box-shadow:
        /* outer drop shadow */
        0 12px 40px rgba(0, 0, 0, 0.55),
        0 4px 12px rgba(0, 0, 0, 0.3),
        /* top highlight rim */
        inset 0 2px 0 rgba(255, 255, 255, 0.25),
        /* inner shadow for depth */
        inset 0 -2px 6px rgba(0, 0, 0, 0.15);
    position: relative;
}

/* Inner reddish-brown border line */
.board-wrapper::before {
    content: "";
    position: absolute;
    top: 12px;
    left: 12px;
    right: 12px;
    bottom: 12px;
    border: 2.5px solid var(--board-frame-dark);
    border-radius: 10px;
    pointer-events: none;
    z-index: 0;
}

/* ─────────────── Board Inner (Grid Area) ─────────────── */
.board-inner {
    position: relative;
    background:
        /* subtle wood texture */
        repeating-linear-gradient(90deg,
            rgba(0, 0, 0, 0.02) 0px,
            rgba(0, 0, 0, 0.02) 1px,
            transparent 1px,
            transparent 5px),
        repeating-linear-gradient(0deg,
            rgba(0, 0, 0, 0.012) 0px,
            rgba(0, 0, 0, 0.012) 1px,
            transparent 1px,
            transparent 9px),
        linear-gradient(180deg, var(--board-bg-light) 0%, var(--board-bg) 50%, var(--board-bg-light) 100%);

    /* Dimensions set by JS via CSS custom properties */
    overflow: visible;
    user-select: none;
    -webkit-user-select: none;
    cursor: default;
}

/* ─────────────── SVG Grid Overlay ─────────────── */
.board-svg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
}

/* ─────────────── Pieces ─────────────── */
.piece {
    position: absolute;
    z-index: 5;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    -webkit-user-select: none;

    /* Double-ring coin effect via box-shadow */
    transition:
        transform 0.18s cubic-bezier(.25, .8, .25, 1),
        box-shadow 0.18s cubic-bezier(.25, .8, .25, 1),
        filter 0.18s ease;
}

/* ─── Slide Animation ─── */
.piece--sliding {
    transition: transform 0.45s cubic-bezier(0.33, 1, 0.68, 1) !important;
    z-index: 50 !important;
    pointer-events: none !important;
}

/* ─── Captured Piece Fade-Out ─── */
.piece--captured {
    animation: fadeOutPiece 0.15s ease-out forwards;
    pointer-events: none !important;
}

@keyframes fadeOutPiece {
    to {
        opacity: 0;
        transform: scale(0.6);
    }
}

/* ─── Board Animating Lock ─── */
.board--animating {
    pointer-events: none !important;
}

/* Red pieces */
.piece-red {
    background: radial-gradient(circle at 38% 32%,
            var(--piece-red-highlight) 0%,
            var(--piece-red-inner) 40%,
            var(--piece-red-outer) 100%);
    box-shadow:
        /* outer colored ring */
        0 0 0 3px var(--piece-red-outer),
        /* cream inner ring */
        0 0 0 5px var(--piece-rim),
        /* outer border */
        0 0 0 6px #8b1a1a,
        /* drop shadow */
        0 4px 10px rgba(0, 0, 0, 0.4),
        /* inner gloss */
        inset 0 2px 4px rgba(255, 255, 255, 0.25),
        inset 0 -2px 4px rgba(0, 0, 0, 0.15);
    color: #fff;
    text-shadow:
        0 1px 2px rgba(0, 0, 0, 0.5),
        0 0 8px rgba(255, 200, 200, 0.3);
}

/* Black pieces */
.piece-black {
    background: radial-gradient(circle at 38% 32%,
            var(--piece-black-highlight) 0%,
            var(--piece-black-inner) 40%,
            var(--piece-black-outer) 100%);
    box-shadow:
        /* outer colored ring */
        0 0 0 3px var(--piece-black-outer),
        /* cream inner ring */
        0 0 0 5px var(--piece-rim),
        /* outer border */
        0 0 0 6px #111,
        /* drop shadow */
        0 4px 10px rgba(0, 0, 0, 0.5),
        /* inner gloss */
        inset 0 2px 4px rgba(255, 255, 255, 0.15),
        inset 0 -2px 4px rgba(0, 0, 0, 0.2);
    color: #e8e0d0;
    text-shadow:
        0 1px 2px rgba(0, 0, 0, 0.6),
        0 0 6px rgba(200, 200, 200, 0.2);
}

/* Piece text (Chinese character) — always XiangqiSerif, no fallback variation */
.piece-text {
    font-family: 'XiangqiSerif', serif !important;
    font-weight: bold !important;
    line-height: 1;
    pointer-events: none;
}

/* ─── Piece Hover ─── */
.piece:hover {
    transform: translateY(-2px);
    filter: brightness(1.08);
    z-index: 10;
}

.piece-red:hover {
    box-shadow:
        0 0 0 3px var(--piece-red-outer),
        0 0 0 5px var(--piece-rim),
        0 0 0 6px #8b1a1a,
        0 6px 16px rgba(0, 0, 0, 0.5),
        inset 0 2px 4px rgba(255, 255, 255, 0.25),
        inset 0 -2px 4px rgba(0, 0, 0, 0.15);
}

.piece-black:hover {
    box-shadow:
        0 0 0 3px var(--piece-black-outer),
        0 0 0 5px var(--piece-rim),
        0 0 0 6px #111,
        0 6px 16px rgba(0, 0, 0, 0.6),
        inset 0 2px 4px rgba(255, 255, 255, 0.15),
        inset 0 -2px 4px rgba(0, 0, 0, 0.2);
}

/* ─── Piece Selected ─── */
.piece.selected {
    transform: translateY(-2px);
    filter: brightness(1.1);
    z-index: 20;
}

.piece-red.selected {
    box-shadow:
        0 0 0 3px var(--piece-red-outer),
        0 0 0 5px var(--piece-rim),
        0 0 0 6px #8b1a1a,
        /* Golden glow ring */
        0 0 0 9px var(--highlight-gold),
        0 0 18px rgba(240, 180, 41, 0.5),
        0 6px 16px rgba(0, 0, 0, 0.4),
        inset 0 2px 4px rgba(255, 255, 255, 0.25),
        inset 0 -2px 4px rgba(0, 0, 0, 0.15);
}

.piece-black.selected {
    box-shadow:
        0 0 0 3px var(--piece-black-outer),
        0 0 0 5px var(--piece-rim),
        0 0 0 6px #111,
        /* Golden glow ring */
        0 0 0 9px var(--highlight-gold),
        0 0 18px rgba(240, 180, 41, 0.5),
        0 6px 16px rgba(0, 0, 0, 0.5),
        inset 0 2px 4px rgba(255, 255, 255, 0.15),
        inset 0 -2px 4px rgba(0, 0, 0, 0.2);
}

/* ─── Legal Move Hint Dots ─── */
.hint-dot {
    position: absolute;
    z-index: 3;
    pointer-events: none;
    border-radius: 50%;
    background: var(--hint-orange);
    opacity: 0.8;
    box-shadow: 0 0 6px rgba(230, 126, 34, 0.5);
}

/* ─── Last Move Indicator ─── */
.last-move-target::after {
    content: '';
    position: absolute;
    top: -4px;
    left: -4px;
    right: -4px;
    bottom: -4px;
    border-radius: 50%;
    border: 2.5px solid #e67e22;
    /* Earthy orange */
    box-shadow: 0 0 8px rgba(230, 126, 34, 0.6);
    /* Glow halo */
    pointer-events: none;
    z-index: 6;
    /* Above piece, below dragged */
}

/* ─── Capture Target Ring (Purple) ─── */
.capture-target::before {
    content: '';
    position: absolute;
    top: -6px;
    left: -6px;
    right: -6px;
    bottom: -6px;
    border-radius: 50%;
    border: 2.5px solid #8b5cf6;
    box-shadow:
        0 0 10px rgba(139, 92, 246, 0.55),
        0 0 20px rgba(139, 92, 246, 0.25);
    pointer-events: none;
    z-index: 7;
}

/* ─── King In-Check Ring (Red, Pulsing) ─── */
@keyframes checkPulse {
    0% {
        box-shadow: 0 0 0 4px rgba(220, 38, 38, 0.9), 0 0 14px rgba(220, 38, 38, 0.7);
    }

    50% {
        box-shadow: 0 0 0 6px rgba(220, 38, 38, 0.5), 0 0 26px rgba(220, 38, 38, 0.4);
    }

    100% {
        box-shadow: 0 0 0 4px rgba(220, 38, 38, 0.9), 0 0 14px rgba(220, 38, 38, 0.7);
    }
}

.piece-red.king-in-check {
    box-shadow:
        0 0 0 3px var(--piece-red-outer),
        0 0 0 5px var(--piece-rim),
        0 0 0 6px #8b1a1a,
        0 0 0 9px rgba(220, 38, 38, 0.9),
        0 0 20px rgba(220, 38, 38, 0.6),
        0 4px 10px rgba(0, 0, 0, 0.4),
        inset 0 2px 4px rgba(255, 255, 255, 0.25),
        inset 0 -2px 4px rgba(0, 0, 0, 0.15);
    animation: checkPulse 1s ease-in-out infinite;
    z-index: 20;
}

.piece-black.king-in-check {
    box-shadow:
        0 0 0 3px var(--piece-black-outer),
        0 0 0 5px var(--piece-rim),
        0 0 0 6px #111,
        0 0 0 9px rgba(220, 38, 38, 0.9),
        0 0 20px rgba(220, 38, 38, 0.6),
        0 4px 10px rgba(0, 0, 0, 0.5),
        inset 0 2px 4px rgba(255, 255, 255, 0.15),
        inset 0 -2px 4px rgba(0, 0, 0, 0.2);
    animation: checkPulse 1s ease-in-out infinite;
    z-index: 20;
}

/* ─── Check Overlay Text "將軍" ─── */
@keyframes checkTextAnim {
    0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.75);
    }

    12% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1.05);
    }

    20% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }

    80% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }

    100% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.9);
    }
}

.check-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    z-index: 200;
    font-family: 'Ma Shan Zheng', 'KaiTi', cursive;
    font-size: 3.6rem;
    font-weight: 900;
    letter-spacing: 0.06em;
    color: #c0392b;
    text-shadow:
        0 0 18px rgba(220, 38, 38, 0.8),
        0 0 40px rgba(220, 38, 38, 0.35),
        2px 3px 6px rgba(0, 0, 0, 0.7);
    opacity: 0;
    user-select: none;
    white-space: nowrap;
}

.check-overlay.show {
    animation: checkTextAnim 1.4s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

/* ─── Board Shake ─── */
@keyframes boardShake {
    0% {
        transform: translateX(0);
    }

    18% {
        transform: translateX(-5px);
    }

    36% {
        transform: translateX(5px);
    }

    54% {
        transform: translateX(-3px);
    }

    72% {
        transform: translateX(3px);
    }

    88% {
        transform: translateX(-1px);
    }

    100% {
        transform: translateX(0);
    }
}

.board-wrapper.board--shaking {
    animation: boardShake 0.22s ease-out;
}

/* ─── Old Position Marker (Transient) ─── */
.old-pos-marker {
    position: absolute;
    width: 12px;
    height: 12px;
    background-color: #d35400;
    /* Dark Orange */
    /* Brown semi-transparent */
    border-radius: 50%;
    transform: translate(-50%, -50%);
    /* Centering */
    z-index: 2;
    /* Above board, below pieces */
    pointer-events: none;
    opacity: 1;
    transition: opacity 0.5s ease-out;
}

/* ═══════════════════════════════════════════════════════════
   Game Action Panel  ── Phong cách gỗ / sơn mài / đồng cổ
   ═══════════════════════════════════════════════════════════ */

/* ── Panel (bảng gỗ) ── */
.game-actions {
    position: fixed;
    top: calc(20px + env(safe-area-inset-top));
    z-index: 9999;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: stretch;
    gap: 12px;

    /* Per-panel positioning */
    &.timer-panel {
        right: calc(18px + env(safe-area-inset-right));
    }

    &.actions-panel {
        left: calc(18px + env(safe-area-inset-left));
    }

    /* Bảng treo: chiều rộng cố định, ôm đủ 3 nút */
    width: clamp(170px, 14vw, 220px);
    padding: 20px 16px;

    /* Gỗ mahogany sẫm + vân nhẹ */
    background: repeating-linear-gradient(178deg,
        rgba(255, 220, 160, .025) 0px,
        rgba(255, 220, 160, .025) 1px,
        transparent 1px,
        transparent 6px),
    linear-gradient(165deg, #3a1c0e 0%, #2b1308 50%, #1e0d06 100%);

    /* Viền đồng hai lớp */
    border: 2px solid #7a5a28;
    outline: 1px solid #c9944a;
    outline-offset: -5px;
    border-radius: 6px;

    /* Hiệu ứng chiều sâu như bảng đồng */
    box-shadow: 0 0 0 1px #3a1c0e,
    0 8px 32px rgba(0, 0, 0, .7),
    0 2px 6px rgba(0, 0, 0, .5),
    inset 0 1px 0 rgba(255, 200, 100, .18),
    inset 0 -1px 0 rgba(0, 0, 0, .5);
}

/* ── Hoa văn góc giả (corner ornaments via CSS) ── */
.game-actions::before,
.game-actions::after {
    content: '◈';
    position: absolute;
    font-size: 0.65rem;
    color: #c9944a;
    opacity: 0.75;
    line-height: 1;
    pointer-events: none;
}

.game-actions::before {
    top: 5px;
    left: 6px;
}

.game-actions::after {
    bottom: 5px;
    right: 6px;
}

/* ── Nút (thẻ lệnh sơn mài) ── */
.ga-btn {
    appearance: none;
    display: block;
    position: relative;
    /* cần cho ::before (triện) */
    width: 100%;
    box-sizing: border-box;
    /* border + padding tính vào 100% */
    border: none;
    border-radius: 4px;
    padding: 13px 28px 13px 14px;

    /* Font cổ điển, hỗ trợ tiếng Việt đầy đủ */
    font-family: 'Noto Serif', 'Times New Roman', serif;
    font-size: 0.9rem;
    font-weight: 700;
    letter-spacing: .06em;
    cursor: pointer;
    text-decoration: none;
    text-align: left;
    user-select: none;

    /* Màu chữ ngà */
    color: #f5e6c8;
    text-shadow: 0 1px 3px rgba(0, 0, 0, .7);

    /* Bevel: sáng trên, tối dưới – cảm giác nổi */
    box-shadow:
        inset 0 1px 0 rgba(255, 220, 140, .25),
        inset 0 -2px 0 rgba(0, 0, 0, .4),
        2px 3px 8px rgba(0, 0, 0, .5);

    transition:
        transform .12s ease,
        box-shadow .12s ease,
        filter .12s ease;
}

/* ── Ấn triện đỏ (góc phải mỗi nút) ── */
.ga-btn::before {
    content: attr(data-seal);
    position: absolute;
    right: 5px;
    top: 50%;
    transform: translateY(-50%);
    font-family: 'Ma Shan Zheng', serif;
    font-size: 0.58rem;
    line-height: 1;
    color: #fff;
    background: #c0392b;
    border: 1px solid #8b1a1a;
    border-radius: 2px;
    padding: 1px 2px;
    opacity: 0.9;
    box-shadow: inset 0 1px 0 rgba(255, 100, 100, .3);
    pointer-events: none;
}

/* ── Hover: ánh sơn mài lướt qua ── */
.ga-btn:hover {
    transform: translateY(-1px);
    filter: brightness(1.15);
    box-shadow:
        inset 0 1px 0 rgba(255, 240, 180, .35),
        inset 0 -2px 0 rgba(0, 0, 0, .5),
        2px 5px 14px rgba(0, 0, 0, .55);
}

/* ── Active: lún xuống như ấn vào gỗ ── */
.ga-btn:active {
    transform: translateY(1px);
    filter: brightness(0.88);
    box-shadow:
        inset 0 2px 4px rgba(0, 0, 0, .5),
        inset 0 -1px 0 rgba(255, 200, 80, .1),
        1px 1px 4px rgba(0, 0, 0, .5);
}

/* ── XIN THUA (đỏ son) ── */
.ga-btn--resign {
    background: linear-gradient(160deg, #7a1c10 0%, #5a1209 100%);
    border: 1px solid #a03020;
}

.ga-btn--resign::before {
    content: attr(data-seal);
    background: #8b1a1a;
}

/* ── CẦU HÒA (vàng nghệ / đồng) ── */
.ga-btn--draw {
    background: linear-gradient(160deg, #6b4e0a 0%, #4a3407 100%);
    border: 1px solid #9a7220;
    color: #ffe9a0;
}

.ga-btn--draw::before {
    content: attr(data-seal);
    background: #7a5a10;
}

/* ── THOÁI LUI (xanh than / chàm) ── */
.ga-btn--exit {
    background: linear-gradient(160deg, #1a2e3e 0%, #0e1e2a 100%);
    border: 1px solid #2e5070;
}

.ga-btn--exit::before {
    content: attr(data-seal);
    background: #1e3e54;
}

/* ══════════ Mobile ══════════ */
@media (max-width: 520px) {
    .game-actions {
        flex-direction: row;
        justify-content: center;
        align-items: center;
        width: auto;
        min-height: unset;
        gap: 8px;
        padding: 10px 12px;
        top: auto;
        border-radius: 6px;
    }

    .game-actions.timer-panel {
        top: calc(10px + env(safe-area-inset-top));
        bottom: auto;
        right: 50%;
        left: auto;
        transform: translateX(50%);
    }

    .game-actions.actions-panel {
        bottom: calc(14px + env(safe-area-inset-bottom));
        right: 50%;
        left: auto;
        transform: translateX(50%);
    }

    .game-actions::before {
        top: 3px;
        left: 4px;
    }

    .game-actions::after {
        bottom: 3px;
        right: 4px;
    }

    .ga-btn {
        padding: 9px 20px 9px 10px;
        font-size: 0.85rem;
    }
}

/* ── Timer Plaque (Đồng hồ ván đấu) ── */
.timer-plaque {
    position: relative;
    background: linear-gradient(160deg, #3a1c0e 0%, #2b1308 50%, #1e0d06 100%);
    border: 1px solid #9a7220;
    border-radius: 4px;
    padding: 10px 12px;
    text-align: center;
    box-shadow: inset 0 1px 0 rgba(255, 200, 100, .15), 0 2px 6px rgba(0, 0, 0, 0.5);
    margin-bottom: 2px;
    user-select: none;
}

.timer-plaque::before,
.timer-plaque::after {
    content: '◈';
    position: absolute;
    font-size: 0.55rem;
    color: #c9944a;
    opacity: 0.65;
    pointer-events: none;
    line-height: 1;
}

.timer-plaque::before {
    top: 3px;
    left: 4px;
}

.timer-plaque::after {
    bottom: 3px;
    right: 4px;
}

.timer-label {
    font-family: 'Noto Serif', serif;
    font-size: 0.75rem;
    color: #d4b87a;
    letter-spacing: 0.05em;
    margin-bottom: 5px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 6px;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
}

.timer-seal {
    font-family: 'Ma Shan Zheng', serif;
    font-size: 0.65rem;
    color: #fff;
    background: #c0392b;
    border: 1px solid #8b1a1a;
    border-radius: 2px;
    padding: 0 2px;
    line-height: 1.1;
    box-shadow: inset 0 1px 0 rgba(255, 100, 100, .3);
}

.timer-value {
    font-family: 'Courier New', monospace;
    font-size: 1.3rem;
    font-weight: bold;
    color: #f5e6c8;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.9);
    font-variant-numeric: tabular-nums;
    transition: opacity 0.3s ease, color 0.3s ease;
}

.timer-value.paused {
    opacity: 0.7;
    color: #d4b87a;
}

.timer-value.paused::after {
    content: ' (tạm dừng)';
    font-family: 'Noto Sans SC', sans-serif;
    font-size: 0.65rem;
    font-weight: normal;
    vertical-align: middle;
    letter-spacing: 0;
}

.timer-value.ended {
    color: #d4b87a;
}

.timer-value.ended::after {
    content: ' (K.Thúc)';
    font-family: 'Noto Sans SC', sans-serif;
    font-size: 0.65rem;
    font-weight: normal;
    vertical-align: middle;
    letter-spacing: 0;
}

/* ── BGM Control ── */
.bgm-control {
    display: flex;
    align-items: center;
    gap: 10px;
    justify-content: space-between;
    padding: 8px 12px;
    margin-bottom: 12px;
}

.bgm-btn {
    background: linear-gradient(160deg, #6b4e0a 0%, #4a3407 100%);
    border: 1px solid #9a7220;
    color: #f5e6c8;
    border-radius: 4px;
    width: 32px;
    height: 32px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-family: 'Ma Shan Zheng', serif;
    font-size: 1.15rem;
    box-shadow: inset 0 1px 0 rgba(255, 200, 100, .15), 0 2px 4px rgba(0, 0, 0, 0.5);
    transition: transform 0.1s, filter 0.1s;
    flex-shrink: 0;
}

.bgm-btn:hover {
    filter: brightness(1.2);
}

.bgm-btn:active {
    transform: translateY(1px);
}

.bgm-btn.muted {
    filter: grayscale(1) brightness(0.6);
    opacity: 0.8;
}

.bgm-slider {
    flex-grow: 1;
    -webkit-appearance: none;
    background: transparent;
    height: 20px;
    cursor: pointer;
    margin: 0;
}

.bgm-slider:focus {
    outline: none;
}

.bgm-slider::-webkit-slider-runnable-track {
    width: 100%;
    height: 6px;
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid #7a5a28;
    border-radius: 3px;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.8);
}

.bgm-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    height: 16px;
    width: 12px;
    background: linear-gradient(to bottom, #f0b429, #c9944a);
    border: 1px solid #4a3407;
    border-radius: 2px;
    margin-top: -6px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.6);
}

.bgm-slider::-moz-range-track {
    width: 100%;
    height: 6px;
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid #7a5a28;
    border-radius: 3px;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.8);
}

.bgm-slider::-moz-range-thumb {
    height: 16px;
    width: 12px;
    background: linear-gradient(to bottom, #f0b429, #c9944a);
    border: 1px solid #4a3407;
    border-radius: 2px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.6);
}



/* ═══════════════════════════════════════════════════════════════════
   Endgame Modal  ── Cuộn thư cổ trang  (古卷 phong cách kiếm hiệp)
   ═══════════════════════════════════════════════════════════════════ */

/* ── Backdrop: đêm giang hồ ── */
.egm-overlay {
    position: fixed;
    inset: 0;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    background:
        radial-gradient(ellipse at 50% 30%, rgba(60, 20, 0, .25) 0%, transparent 70%),
        rgba(8, 5, 3, 0.82);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    animation: egmFadeIn .35s ease forwards;
}

.egm-overlay[hidden] {
    display: none;
}

@keyframes egmFadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* ── Cuộn thư (scroll container) ── */
.egm-scroll {
    position: relative;
    width: clamp(300px, 88vw, 480px);
    animation: egmUnfurl .45s cubic-bezier(.22, .68, 0, 1.2) forwards;
    transform-origin: center top;
}

@keyframes egmUnfurl {
    from {
        transform: scaleY(0.1);
        opacity: 0;
    }

    to {
        transform: scaleY(1);
        opacity: 1;
    }
}

/* ── Trục cuộn (rod bars) — hiệu ứng trụ đồng 3D ── */
.egm-rod {
    height: 22px;
    border-radius: 11px;
    background:
        linear-gradient(180deg,
            #e8c97a 0%,
            #a07830 25%,
            #c9a048 50%,
            #7a5018 75%,
            #c0903a 100%);
    box-shadow:
        0 4px 12px rgba(0, 0, 0, .6),
        inset 0 2px 3px rgba(255, 240, 180, .4),
        inset 0 -2px 3px rgba(0, 0, 0, .4);
    position: relative;
    z-index: 2;
}

.egm-rod--top {
    border-radius: 11px 11px 0 0;
    margin-bottom: -2px;
}

.egm-rod--bottom {
    border-radius: 0 0 11px 11px;
    margin-top: -2px;
}

/* Rod end caps (circles on left/right) */
.egm-rod::before,
.egm-rod::after {
    content: '';
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background:
        radial-gradient(circle at 40% 35%,
            #f0d890 0%,
            #b08838 45%,
            #7a5820 100%);
    box-shadow: 0 2px 6px rgba(0, 0, 0, .5);
}

.egm-rod::before {
    left: -8px;
}

.egm-rod::after {
    right: -8px;
}

/* ── Thân cuộn (giấy gạo) ── */
.egm-body {
    position: relative;
    padding: 32px 36px 40px;
    background:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E"),
        linear-gradient(170deg, #f2e4c0 0%, #ead5a0 40%, #e4cc8e 100%);
    border-left: 2px solid #c9a050;
    border-right: 2px solid #c9a050;
    overflow: visible;
}

/* ── Chữ Hán lớn (mực tàu / mực đỏ) ── */
.egm-hanzi {
    font-family: 'Ma Shan Zheng', serif;
    font-size: clamp(3.5rem, 12vw, 5.5rem);
    line-height: 1;
    text-align: center;
    color: #8b1a1a;
    text-shadow:
        0 2px 0 rgba(0, 0, 0, .25),
        0 4px 16px rgba(139, 26, 26, .35);
    margin-bottom: 8px;
    letter-spacing: .04em;
}

/* Draw variant: vàng đồng */
.egm-scroll[data-type="draw"] .egm-hanzi {
    color: #6b4a08;
}

/* ── Đường kẻ trang trí (divider) ── */
.egm-divider {
    height: 1px;
    margin: 0 auto 18px;
    width: 70%;
    background: linear-gradient(90deg,
            transparent 0%,
            #a07830 20%,
            #c9a048 50%,
            #a07830 80%,
            transparent 100%);
}

/* ── Subtitle + reason (tiếng Việt) ── */
.egm-subtitle {
    font-family: 'Noto Serif', serif;
    font-size: 1.05rem;
    font-weight: 700;
    color: #3a2010;
    text-align: center;
    letter-spacing: .04em;
    margin-bottom: 6px;
}

.egm-reason {
    font-family: 'Noto Serif', serif;
    font-size: 0.82rem;
    font-style: italic;
    color: #6a4820;
    text-align: center;
    margin-bottom: 24px;
    letter-spacing: .02em;
}

/* ── Nút CTA (thẻ gỗ) ── */
.egm-actions {
    display: flex;
    gap: 14px;
    justify-content: center;
}

.egm-btn {
    display: inline-block;
    padding: 10px 22px;
    border-radius: 4px;
    font-family: 'Noto Serif', serif;
    font-size: 0.88rem;
    font-weight: 700;
    letter-spacing: .06em;
    cursor: pointer;
    text-decoration: none;
    user-select: none;
    box-sizing: border-box;
    border: none;
    transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
}

.egm-btn--retry {
    background: linear-gradient(160deg, #7a1c10 0%, #5a1209 100%);
    color: #f5e0c0;
    box-shadow:
        inset 0 1px 0 rgba(255, 180, 120, .25),
        inset 0 -2px 0 rgba(0, 0, 0, .4),
        2px 3px 8px rgba(0, 0, 0, .4);
    border: 1px solid #a03020;
}

.egm-btn--home {
    background: linear-gradient(160deg, #3a2c18 0%, #241a0c 100%);
    color: #d4b87a;
    box-shadow:
        inset 0 1px 0 rgba(255, 200, 100, .2),
        inset 0 -2px 0 rgba(0, 0, 0, .35),
        2px 3px 8px rgba(0, 0, 0, .4);
    border: 1px solid #6a4a18;
}

.egm-btn:hover {
    transform: translateY(-1px);
    filter: brightness(1.15);
}

.egm-btn:active {
    transform: translateY(1px);
    filter: brightness(0.88);
}

/* ── Triện đỏ (seal stamp) ── */
.egm-seal {
    position: absolute;
    bottom: 28px;
    right: 30px;
    width: 54px;
    height: 54px;
    display: flex;
    align-items: center;
    justify-content: center;

    font-family: 'Ma Shan Zheng', serif;
    font-size: 1.8rem;
    color: rgba(255, 255, 255, .92);

    background: #a81c1c;
    border: 2px solid #7a1010;
    border-radius: 4px;
    box-shadow:
        inset 0 1px 0 rgba(255, 100, 100, .3),
        2px 3px 8px rgba(100, 0, 0, .35);

    /* Hidden until stamped */
    opacity: 0;
    transform: scale(1.6) rotate(-8deg);
    transform-origin: center center;
    transition: none;
}

/* Draw: triện vàng đồng */
.egm-scroll[data-type="draw"] .egm-seal {
    background: #8a6010;
    border-color: #5a3a08;
}

/* Stamp animation */
.egm-seal--stamped {
    animation: egmStamp .28s cubic-bezier(.22, .68, 0, 1.3) forwards;
}

@keyframes egmStamp {
    0% {
        opacity: 0;
        transform: scale(1.8) rotate(-10deg);
    }

    65% {
        opacity: 1;
        transform: scale(0.92) rotate(2deg);
    }

    85% {
        transform: scale(1.06) rotate(-1deg);
    }

    100% {
        opacity: .9;
        transform: scale(1) rotate(0deg);
    }
}

/* ── Mobile ── */
@media (max-width: 520px) {
    .egm-body {
        padding: 22px 20px 32px;
    }

    .egm-hanzi {
        font-size: 3rem;
    }

    .egm-subtitle {
        font-size: 0.95rem;
    }

    .egm-seal {
        width: 44px;
        height: 44px;
        font-size: 1.4rem;
        bottom: 18px;
        right: 18px;
    }

    .egm-actions {
        flex-direction: column;
        align-items: center;
    }

    .egm-btn {
        width: 100%;
        text-align: center;
    }
}

/* ═══════════════════════════════════════════════════════════════════
   Confirm Resign Modal  ── Bảng gỗ khắc / viền đồng cổ trang
   ═══════════════════════════════════════════════════════════════════ */

/* ── Backdrop ── */
.cfm-overlay {
    position: fixed;
    inset: 0;
    z-index: 10500;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(14, 6, 2, 0.58);
    backdrop-filter: blur(3px);
    -webkit-backdrop-filter: blur(3px);
    animation: cfmFadeIn .22s ease forwards;
}

.cfm-overlay[hidden] {
    display: none;
}

@keyframes cfmFadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

/* ── Modal box (bảng gỗ mahogany + viền đồng) ── */
.cfm-box {
    position: relative;
    width: clamp(300px, 90vw, 440px);
    padding: 28px 28px 24px;
    animation: cfmSlideIn .25s cubic-bezier(.22, .68, 0, 1.15) forwards;

    /* Nền gỗ trầm + vân nhẹ */
    background:
        repeating-linear-gradient(178deg,
            rgba(255, 220, 160, .022) 0px,
            rgba(255, 220, 160, .022) 1px,
            transparent 1px,
            transparent 6px),
        repeating-linear-gradient(88deg,
            rgba(0, 0, 0, .03) 0px,
            rgba(0, 0, 0, .03) 1px,
            transparent 1px,
            transparent 10px),
        linear-gradient(165deg, #3d1e0f 0%, #2a1209 55%, #1e0c06 100%);

    /* Viền đồng hai lớp */
    border: 2px solid #7a5a28;
    outline: 1px solid #c9944a;
    outline-offset: -6px;
    border-radius: 6px;

    box-shadow:
        0 0 0 1px #2a1009,
        0 16px 48px rgba(0, 0, 0, .75),
        0 4px 12px rgba(0, 0, 0, .5),
        inset 0 1px 0 rgba(255, 200, 100, .18),
        inset 0 -1px 0 rgba(0, 0, 0, .5);
}

@keyframes cfmSlideIn {
    from {
        transform: scale(.88) translateY(-10px);
        opacity: 0;
    }

    to {
        transform: scale(1) translateY(0);
        opacity: 1;
    }
}

/* ── Hoa văn góc (corner ornaments) ── */
.cfm-box::before,
.cfm-box::after {
    content: '◈';
    position: absolute;
    font-size: .6rem;
    color: #c9944a;
    opacity: .7;
    pointer-events: none;
    line-height: 1;
}

.cfm-box::before {
    top: 6px;
    left: 8px;
}

.cfm-box::after {
    bottom: 6px;
    right: 8px;
}

/* ── Header ── */
.cfm-header {
    text-align: center;
    margin-bottom: 18px;
}

.cfm-header-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    margin-bottom: 8px;
    font-family: 'Ma Shan Zheng', serif;
    font-size: 1.3rem;
    color: #fff;
    background: #a81c1c;
    border: 1.5px solid #7a1010;
    border-radius: 3px;
    box-shadow: inset 0 1px 0 rgba(255, 100, 100, .25), 0 2px 6px rgba(100, 0, 0, .4);
}

.cfm-hanzi {
    display: block;
    font-family: 'Ma Shan Zheng', serif;
    font-size: 1.2rem;
    color: #c9944a;
    letter-spacing: .08em;
    line-height: 1.2;
    text-shadow: 0 1px 3px rgba(0, 0, 0, .6);
    margin-bottom: 4px;
}

.cfm-title {
    display: block;
    font-family: 'Noto Serif', 'Times New Roman', serif;
    font-size: 1.0rem;
    font-weight: 700;
    color: #f0ddb8;
    letter-spacing: .04em;
    text-shadow: 0 1px 3px rgba(0, 0, 0, .7);
}

/* ── Lose Screen Specific ── */
.lose-hanzi {
    font-family: 'Ma Shan Zheng', serif;
    font-size: clamp(3.5rem, 12vw, 4.5rem);
    line-height: 1.1;
    text-align: center;
    color: #8b1a1a;
    text-shadow:
        0 2px 0 rgba(0, 0, 0, .25),
        0 4px 16px rgba(139, 26, 26, .35);
    margin-bottom: 4px;
    letter-spacing: .04em;
}

.lose-seal {
    position: absolute;
    bottom: 24px;
    right: 24px;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;

    font-family: 'Ma Shan Zheng', serif;
    font-size: 1.6rem;
    color: rgba(255, 255, 255, .92);

    background: #a81c1c;
    border: 2px solid #7a1010;
    border-radius: 4px;
    box-shadow:
        inset 0 1px 0 rgba(255, 100, 100, .3),
        2px 3px 8px rgba(100, 0, 0, .35);

    /* Hidden until stamped */
    opacity: 0;
    transform: scale(1.6) rotate(-8deg);
    transform-origin: center center;
    transition: none;
}

.lose-seal--stamped {
    animation: egmStamp .28s cubic-bezier(.22, .68, 0, 1.3) forwards;
}

/* ── Divider ── */
.cfm-divider {
    height: 1px;
    margin: 0 0 16px;
    background: linear-gradient(90deg,
            transparent 0%,
            #a07830 20%,
            #c9a048 50%,
            #a07830 80%,
            transparent 100%);
}

/* ── Body text ── */
.cfm-body {
    font-family: 'Noto Serif', 'Times New Roman', serif;
    font-size: .88rem;
    font-style: italic;
    color: #c8a878;
    text-align: center;
    line-height: 1.65;
    margin-bottom: 8px;
}

.cfm-result {
    font-family: 'Noto Serif', 'Times New Roman', serif;
    font-size: .82rem;
    color: #a07050;
    text-align: center;
    margin-bottom: 22px;
    letter-spacing: .02em;
}

/* ── Action buttons ── */
.cfm-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
}

.cfm-btn {
    flex: 1;
    max-width: 160px;
    padding: 11px 18px;
    border: none;
    border-radius: 4px;
    font-family: 'Noto Serif', 'Times New Roman', serif;
    font-size: .9rem;
    font-weight: 700;
    letter-spacing: .05em;
    cursor: pointer;
    user-select: none;
    text-align: center;
    text-shadow: 0 1px 3px rgba(0, 0, 0, .7);
    box-sizing: border-box;
    transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
}

/* Cancel — gỗ xám than */
.cfm-btn--cancel {
    background: linear-gradient(160deg, #2e2e2e 0%, #1a1a1a 100%);
    color: #c8c0b0;
    border: 1px solid #4a4a3a;
    box-shadow:
        inset 0 1px 0 rgba(255, 255, 200, .12),
        inset 0 -2px 0 rgba(0, 0, 0, .4),
        2px 3px 8px rgba(0, 0, 0, .5);
}

/* Confirm — đỏ son */
.cfm-btn--confirm {
    background: linear-gradient(160deg, #8b1c10 0%, #621008 100%);
    color: #f5e0c0;
    border: 1px solid #a83020;
    box-shadow:
        inset 0 1px 0 rgba(255, 160, 120, .25),
        inset 0 -2px 0 rgba(0, 0, 0, .4),
        2px 3px 8px rgba(0, 0, 0, .5);
}

/* Draw confirm — vàng đồng (amber/gold) */
.cfm-btn--draw-confirm {
    background: linear-gradient(160deg, #7a5a10 0%, #543d08 100%);
    color: #ffe9a0;
    border: 1px solid #a07a20;
    box-shadow:
        inset 0 1px 0 rgba(255, 230, 140, .28),
        inset 0 -2px 0 rgba(0, 0, 0, .4),
        2px 3px 8px rgba(0, 0, 0, .5);
}

/* Draw modal header icon — gold badge */
.cfm-header-icon--draw {
    background: #7a5a10;
    border-color: #4a3408;
    box-shadow: inset 0 1px 0 rgba(255, 220, 80, .2), 0 2px 6px rgba(80, 50, 0, .4);
}

/* Exit modal header icon — xanh than (navy) */
.cfm-header-icon--exit {
    background: #1a3a52;
    border-color: #2e5a7a;
    box-shadow: inset 0 1px 0 rgba(100, 180, 240, .2), 0 2px 6px rgba(0, 20, 40, .5);
}

/* Exit confirm button — navy steel */
.cfm-btn--exit-confirm {
    background: linear-gradient(160deg, #1a3a52 0%, #0d2235 100%);
    color: #a8d4f0;
    border: 1px solid #2e5a7a;
    box-shadow:
        inset 0 1px 0 rgba(100, 200, 255, .15),
        inset 0 -2px 0 rgba(0, 0, 0, .45),
        2px 3px 8px rgba(0, 0, 0, .5);
}

.cfm-btn:hover {
    transform: translateY(-1px);
    filter: brightness(1.18);
}

.cfm-btn:active {
    transform: translateY(1px);
    filter: brightness(.86);
    box-shadow:
        inset 0 2px 4px rgba(0, 0, 0, .5),
        1px 1px 4px rgba(0, 0, 0, .5);
}

/* Loading / disabled state */
.cfm-btn--confirm:disabled,
.cfm-btn--draw-confirm:disabled,
.cfm-btn--exit-confirm:disabled {
    opacity: .65;
    cursor: not-allowed;
    filter: none;
    transform: none;
}

/* ── Error toast ── */
.cfm-toast {
    position: absolute;
    bottom: calc(100% + 10px);
    left: 50%;
    transform: translateX(-50%);
    white-space: nowrap;
    background: rgba(120, 20, 10, .92);
    color: #f5e0c0;
    font-family: 'Noto Serif', serif;
    font-size: .82rem;
    padding: 7px 16px;
    border-radius: 4px;
    border: 1px solid #a03020;
    box-shadow: 0 4px 12px rgba(0, 0, 0, .5);
    pointer-events: none;
    animation: cfmToastIn .2s ease forwards;
}

@keyframes cfmToastIn {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(6px);
    }

    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

/* ── Mobile ── */
@media (max-width: 520px) {
    .cfm-box {
        padding: 22px 18px 20px;
    }

    .cfm-actions {
        flex-direction: column;
        align-items: stretch;
    }

    .cfm-btn {
        max-width: 100%;
    }
}

/* ═══════════════════════════════════════════════════════════════════
   Game Toasts (Thông báo cổ trang khi đi sai)
   ═══════════════════════════════════════════════════════════════════ */
.game-toast-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 11000;
    display: flex;
    flex-direction: column;
    gap: 12px;
    pointer-events: none;
}

.game-toast {
    position: relative;
    padding: 12px 16px 12px 42px;
    min-width: 220px;
    max-width: 320px;
    background:
        linear-gradient(165deg, #3d1e0f 0%, #2a1209 55%, #1e0c06 100%);
    border: 1px solid #7a5a28;
    outline: 1px solid #c9944a;
    outline-offset: -3px;
    border-radius: 4px;
    box-shadow:
        0 4px 12px rgba(0, 0, 0, .6),
        inset 0 1px 0 rgba(255, 200, 100, .18);
    display: flex;
    align-items: center;
    justify-content: flex-start;
    animation: toastSlideIn .35s cubic-bezier(.22, .68, 0, 1.2) forwards;
    transition: opacity 0.3s ease, transform 0.3s ease;
}

.game-toast::before {
    content: '令';
    position: absolute;
    left: 8px;
    top: 50%;
    transform: translateY(-50%);
    width: 26px;
    height: 26px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Ma Shan Zheng', serif;
    font-size: 1.1rem;
    color: #fff;
    background: #a81c1c;
    border: 1px solid #7a1010;
    border-radius: 2px;
    box-shadow:
        inset 0 1px 0 rgba(255, 100, 100, .25),
        0 2px 4px rgba(100, 0, 0, .4);
    line-height: 1;
}

.game-toast.toast-warning::before {
    content: '禁';
}

.game-toast-message {
    font-family: 'Noto Serif', 'Times New Roman', serif;
    font-size: 0.9rem;
    color: #d4b87a;
    line-height: 1.4;
    text-shadow: 0 1px 2px rgba(0, 0, 0, .8);
}

.game-toast.hiding {
    opacity: 0;
    transform: translateX(30px) !important;
}

@keyframes toastSlideIn {
    from {
        opacity: 0;
        transform: translateX(40px);
    }

    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@media (max-width: 520px) {
    .game-toast-container {
        top: 20px;
        right: 15px;
        left: 15px;
        align-items: center;
    }

    .game-toast {
        min-width: unset;
        width: 100%;
        max-width: 320px;
    }
}

/* ═══════════════════════════════════════════════════════════
   Player Panels — Turn Indicator  (Bảng hiển thị lượt chơi)
   ═══════════════════════════════════════════════════════════ */

/* ── Glow pulse animation (subtle, slow) ── */
@keyframes ppGlowPulse {
    0% {
        box-shadow: 0 0 10px 3px rgba(240, 180, 41, 0.45),
            0 0 24px 6px rgba(240, 180, 41, 0.18);
    }

    50% {
        box-shadow: 0 0 18px 6px rgba(240, 180, 41, 0.65),
            0 0 38px 12px rgba(240, 180, 41, 0.28);
    }

    100% {
        box-shadow: 0 0 10px 3px rgba(240, 180, 41, 0.45),
            0 0 24px 6px rgba(240, 180, 41, 0.18);
    }
}

/* ── Badge slide-in animation ── */
@keyframes ppBadgeSlide {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(-10px);
    }

    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

/* ── Panel base ── */
.player-panel {
    position: fixed;
    bottom: calc(28px + env(safe-area-inset-bottom));
    z-index: 9998;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 16px 14px 14px;
    width: clamp(100px, 10vw, 140px);

    /* Dark wood panel — matches .game-actions */
    background: repeating-linear-gradient(178deg,
            rgba(255, 220, 160, .025) 0px,
            rgba(255, 220, 160, .025) 1px,
            transparent 1px,
            transparent 6px),
        linear-gradient(165deg, #3a1c0e 0%, #2b1308 50%, #1e0d06 100%);
    border: 2px solid #7a5a28;
    outline: 1px solid #c9944a;
    outline-offset: -5px;
    border-radius: 8px;
    box-shadow:
        0 0 0 1px #3a1c0e,
        0 8px 32px rgba(0, 0, 0, .7),
        0 2px 6px rgba(0, 0, 0, .5),
        inset 0 1px 0 rgba(255, 200, 100, .18),
        inset 0 -1px 0 rgba(0, 0, 0, .5);

    /* Inactive: dimmed and desaturated */
    opacity: 0.55;
    filter: saturate(0.5);

    /* Smooth transitions */
    transition:
        opacity 0.2s ease,
        filter 0.2s ease,
        transform 0.2s ease,
        box-shadow 0.2s ease;
}

/* Corner ornaments */
.player-panel::before,
.player-panel::after {
    content: '◈';
    position: absolute;
    font-size: 0.6rem;
    color: #c9944a;
    opacity: 0.65;
    line-height: 1;
    pointer-events: none;
}

.player-panel::before {
    top: 5px;
    left: 6px;
}

.player-panel::after {
    bottom: 5px;
    right: 6px;
}

/* Left panel position */
.player-panel--left {
    left: calc(18px + env(safe-area-inset-left));
}

/* Right panel position */
.player-panel--right {
    right: calc(18px + env(safe-area-inset-right));
}

/* ── Avatar circle ── */
.pp-avatar {
    width: 58px;
    height: 58px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'XiangqiSerif', 'Ma Shan Zheng', serif;
    font-size: 1.6rem;
    font-weight: bold;
    color: #f5e6c8;
    background: radial-gradient(circle at 38% 32%,
            #6b4e2a 0%,
            #3e2512 45%,
            #1e0d06 100%);
    box-shadow:
        0 0 0 2px #7a5a28,
        0 0 0 4px #c9944a44,
        0 4px 10px rgba(0, 0, 0, 0.5),
        inset 0 2px 4px rgba(255, 200, 100, .15);
    transition: box-shadow 0.2s ease;
    position: relative;
}

/* ── Player name label ── */
.pp-name {
    font-family: 'Noto Serif', serif;
    font-size: 0.75rem;
    font-weight: 700;
    color: #d4b87a;
    letter-spacing: 0.06em;
    text-align: center;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.9);
}

/* ── Turn badge pill ── */
.pp-badge {
    position: absolute;
    top: -14px;
    left: 50%;
    transform: translateX(-50%) translateY(-10px);
    background: linear-gradient(135deg, #f0b429 0%, #c9840a 100%);
    color: #1e0d06;
    font-family: 'Noto Sans SC', sans-serif;
    font-size: 0.6rem;
    font-weight: 700;
    letter-spacing: 0.04em;
    padding: 3px 8px;
    border-radius: 20px;
    white-space: nowrap;
    box-shadow:
        0 2px 8px rgba(240, 180, 41, 0.55),
        0 1px 0 rgba(255, 240, 180, 0.4) inset;
    pointer-events: none;
    opacity: 0;
    /* Hidden by default; shown when active */
    transition: opacity 0.15s ease;
}

/* ══════════════════════════════
   Active (currently-moving) side
   ══════════════════════════════ */
.player-panel--active {
    opacity: 1;
    filter: saturate(1);
    transform: translateY(-3px);
    box-shadow:
        0 0 0 1px #3a1c0e,
        0 10px 36px rgba(0, 0, 0, .75),
        0 2px 6px rgba(0, 0, 0, .5),
        inset 0 1px 0 rgba(255, 200, 100, .25),
        inset 0 -1px 0 rgba(0, 0, 0, .5);
}

.player-panel--active .pp-avatar {
    animation: ppGlowPulse 2.4s ease-in-out infinite;
}

.player-panel--active .pp-badge {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
    animation: ppBadgeSlide 0.2s ease-out forwards;
}

/* ══════════════════════════════
   Responsive (narrow screens)
   ══════════════════════════════ */
@media (max-width: 700px) {
    .player-panel {
        bottom: calc(80px + env(safe-area-inset-bottom));
        width: clamp(76px, 15vw, 100px);
        padding: 10px 8px 10px;
        gap: 5px;
    }

    .pp-avatar {
        width: 44px;
        height: 44px;
        font-size: 1.2rem;
    }

    .pp-name {
        font-size: 0.65rem;
    }

    .pp-badge {
        font-size: 0.52rem;
        padding: 2px 6px;
        top: -12px;
    }
}